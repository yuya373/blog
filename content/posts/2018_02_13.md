---
title: "Chrome extension作った"
date: 2018-02-13T00:17:53+09:00
draft: false
isCJKLanguage: true
---
[https://github.com/yuya373/memo](https://github.com/yuya373/memo)

webページに付箋を貼るイメージ

webpack, yarn, babel, react, material-uiあたりを使った。  
material-uiのおかげでcssを書いてないので便利。  
webpack, babel, eslintあたりはいつも設定ファイルの書き方を忘れているのでいつもドキュメントを読みながら書いていくことになる。  
今回書いた設定ファイルもすぐに忘れてしまうだろう。

`chrome.rutime.onMessage.addListner`にははまりどころがあって、非同期処理を`addListner`の中で行うと、コールバックに渡ってくるレスポンスを返す用の関数がgcされてしまい、content-script側でレスポンスが`undefined`になってしまう。  
これは`addListner`の中では基本的に同期処理しか想定していないので、非同期処理をする場合は`addListner`から`true`を返す必要がある。  
[Message Passing - Google Chrome](https://developer.chrome.com/extensions/messaging#simple)

`chrome.storage.sync`を使っているのでchromeにログインしているアカウント間ではデータ共有できるはず。  
`chrome.storage.sync`は`chrome.storage.local`よりレートリミットがきびしいけど、エラー処理とか書いてないのでそのうち書く。  
[chrome.storage - Google Chrome](https://developer.chrome.com/extensions/storage)  
[chrome.storage.sync - Google Chrome](https://developer.chrome.com/extensions/storage#property-sync)

urlをキーにしてメモを保存しているがurlの正規化をせずにそのまま使っているので、`http://example.com`と`https://example.com`では違うurlと認識されるのでそこも改善しないといけない。  
ホストとパスだけチェックすれば良いかな。

- `http://github.com/yuya373/memo` === `https://github.com/yuya373/memo`
- `https://github.com/yuya373/memo#head1` === `https://github.com/yuya373/memo`
- `https://github.com/yuya373/memo?q=hoge` === `https://github.com/yuya373/memo`

